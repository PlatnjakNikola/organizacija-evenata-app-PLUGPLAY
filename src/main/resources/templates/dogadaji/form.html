<!DOCTYPE html>
<html lang="hr" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: base('Događaji','Događaji','dogadaji', ~{::content})}">

<th:block th:fragment="content">
    <!-- Forma (Create/Update) -->
    <form th:action="@{/dogadaji/save}" th:object="${dogadaj}"
          method="post" class="mb-8 grid gap-4 bg-gray-800/40 p-6 rounded-xl">

        <!-- hidden ID za update -->
        <input type="hidden" th:field="*{dogadajID}"/>

        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm text-gray-300 mb-1">Naziv</label>
                <input class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"
                       th:field="*{naziv}" required/>
            </div>

            <div>
                <label class="block text-sm text-gray-300 mb-1">Cijena ulaznice</label>
                <input type="number" step="0.01" min="0"
                       class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"
                       th:field="*{cijenaUlaznice}" required/>
            </div>

            <div class="md:col-span-2">
                <label class="block text-sm text-gray-300 mb-1">Opis</label>
                <textarea rows="3"
                          class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"
                          th:field="*{opis}"></textarea>
            </div>

            <div>
                <label class="block text-sm text-gray-300 mb-1">Datum i vrijeme</label>
                <input type="datetime-local" name="datumVrijeme"
                       th:value="${dogadaj.datumVrijeme != null ? #temporals.format(dogadaj.datumVrijeme, 'yyyy-MM-dd''T''HH:mm') : ''}"
                       class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"
                       required/>
            </div>

            <div>
                <label class="block text-sm text-gray-300 mb-1">Dvorana</label>
                <select name="dvoranaID"
                        class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"
                        required>
                    <option th:each="d : ${dvorane}"
                            th:value="${d.dvoranaID}"
                            th:text="${d.naziv}"
                            th:selected="${dogadaj.dvorana != null} ? ${d.dvoranaID} == ${dogadaj.dvorana.dvoranaID} : false">
                    </option>
                </select>
            </div>

            <div>
                <label class="block text-sm text-gray-300 mb-1">Organizator</label>
                <select name="organizatorID"
                        class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"
                        required>
                    <option th:each="o : ${organizatori}"
                            th:value="${o.organizatorID}"
                            th:text="${o.naziv}"
                            th:selected="${dogadaj.organizator != null} ? ${o.organizatorID} == ${dogadaj.organizator.organizatorID} : false">
                    </option>
                </select>
            </div>
        </div>

        <!-- Cover slika -->
        <div class="md:col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm text-gray-300 mb-1">Cover image URL</label>
                    <input type="url" name="coverUrl"
                           th:value="${!#lists.isEmpty(dogadaj.slike) ? dogadaj.slike.get(0).url : ''}"
                           placeholder="https://example.com/slika.jpg"
                           class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"/>

                    <label class="block text-sm text-gray-300 mb-1 mt-4">Alt tekst (opis slike)</label>
                    <input type="text" name="coverAlt"
                           th:value="${!#lists.isEmpty(dogadaj.slike) ? dogadaj.slike.get(0).alt : ''}"
                           class="w-full rounded-lg bg-gray-900/50 border border-white/10 p-2 text-white"/>
                </div>

                <div class="md:col-span-1">
                    <div class="text-sm font-medium text-gray-200 mb-1">Pregled</div>
                    <div class="aspect-[4/3] w-full overflow-hidden rounded-lg bg-gray-800 border border-white/10">
                        <img th:src="${!#lists.isEmpty(dogadaj.slike) ? dogadaj.slike.get(0).url : 'https://placehold.co/600x400?text=Doga%C4%91aj'}"
                             th:alt="${!#lists.isEmpty(dogadaj.slike) ? dogadaj.slike.get(0).alt : 'cover'}"
                             class="h-full w-full object-cover"/>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex gap-3">
            <button type="submit"
                    class="px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-500">
                Spremi
            </button>
            <a th:href="@{/dogadaji}" class="px-4 py-2 rounded-xl bg-gray-700 text-white hover:bg-gray-600">
                Nova stavka
            </a>
        </div>
    </form>

    <!-- Tablica svih događaja -->
    <div class="overflow-x-auto bg-gray-800/40 rounded-xl">
        <table class="min-w-full divide-y divide-white/10">
            <thead>
            <tr class="text-left text-xs uppercase tracking-wider text-gray-400">
                <th class="px-4 py-3">#</th>
                <th class="px-4 py-3">Naziv</th>
                <th class="px-4 py-3">Opis</th>
                <th class="px-4 py-3">Datum i vrijeme</th>
                <th class="px-4 py-3">Cijena</th>
                <th class="px-4 py-3">Dvorana</th>
                <th class="px-4 py-3">Organizator</th>
                <th class="px-4 py-3">Akcije</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-white/10 text-sm text-white">
            <tr th:each="dog, iStat : ${dogadaji}">
                <td class="px-4 py-3" th:text="${iStat.count}">1</td>
                <td class="px-4 py-3" th:text="${dog.naziv}">Naziv</td>
                <td class="px-4 py-3" th:text="${dog.opis}">Opis</td>
                <td class="px-4 py-3" th:text="${#temporals.format(dog.datumVrijeme, 'yyyy-MM-dd HH:mm')}">2025-09-15 20:00</td>
                <td class="px-4 py-3" th:text="${dog.cijenaUlaznice}">15.00</td>
                <td class="px-4 py-3" th:text="${dog.dvorana != null ? dog.dvorana.naziv : '-'}">Glavna dvorana</td>
                <td class="px-4 py-3" th:text="${dog.organizator != null ? dog.organizator.naziv : '-'}">Jazz kvartet</td>
                <td class="px-4 py-3">
                    <div class="flex items-center gap-2">
                        <a th:href="@{'/dogadaji/edit/' + ${dog.dogadajID}}"
                           class="px-3 py-1 rounded-lg bg-blue-600 hover:bg-blue-500 text-white">Uredi</a>

                        <form th:action="@{'/dogadaji/' + ${dog.dogadajID} + '/delete'}" method="post"
                              onsubmit="return confirm('Obrisati događaj i sve pripadajuće rezervacije/recenzije?');">
                            <button type="submit"
                                    class="px-3 py-1 rounded-lg bg-red-600 hover:bg-red-500 text-white">
                                Obriši
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</th:block>
</html>
